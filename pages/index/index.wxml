<!-- index.wxml -->
<view class="container" style="padding-bottom: 200rpx; padding-top: {{safeAreaTop}}px;">

  <!-- Header -->
  <view class="header-card">
    <view class="avatar-ring">
      <image class="avatar" src="https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwBHbkNy7B9h7Iaa0c8oK1A1sT5M0j1l5Xb8/0" mode="aspectFill"></image> <!-- Placeholder cute cat -->
    </view>
    <view class="info-content">
      <view class="speech-bubble">
        <text>喵～今天也要加油减肥哦！</text>
      </view>
      <view class="msg-row">
        <text class="cat-name">{{catProfile.name}}</text>
        <text class="cat-weight">{{catProfile.currentWeight}} kg</text>
        <view class="edit-icon" bindtap="goToProfile">✏️</view>
      </view>
    </view>
  </view>

  <!-- Energy Ring -->
  <view class="ring-section">
    <view class="ring-container">
      <!-- Simple CSS-based Circular Progress (Approximation for MVP) -->
      <view class="progress-circle" style="background: conic-gradient(var(--color-primary) {{percent}}%, #F1F2F6 0);">
        <view class="inner-circle">
          <text class="main-num">{{remaining}}</text>
          <text class="label">今日剩余 kcal</text>
        </view>
      </view>
    </view>
    <view class="stats-row">
      <text>目标: {{todayGoal}}</text>
      <text class="divider">|</text>
      <text>已吃: {{consumed}}</text>
    </view>
  </view>

  <!-- Feeding Action Bar (Moved to Middle) -->
  <view class="feeding-actions">
    <view class="action-btn" bindtap="onAddFood" data-type="dry">
      <view class="btn-icon-circle bg-cream">🥣</view>
      <text>干粮</text>
    </view>
    <view class="action-btn" bindtap="onAddFood" data-type="wet">
      <view class="btn-icon-circle bg-mint">🐟</view>
      <text>湿粮</text>
    </view>
    <view class="action-btn" bindtap="onAddFood" data-type="treats">
      <view class="btn-icon-circle bg-orange">🍬</view>
      <text>零食</text>
    </view>
  </view>

  <!-- Log List -->
  <view class="log-section">
    <text class="section-title">今日记录</text>
    <view class="log-list">
      <block wx:if="{{logs.length > 0}}">
        <view class="log-item-wrapper" wx:for="{{logs}}" wx:key="id">
          <!-- Action Buttons (Hidden behind) -->
          <view class="action-buttons">
            <view class="action-btn action-edit" bindtap="onEditLog" data-id="{{item.id}}">
              <text class="action-icon">✏️</text>
            </view>
            <view class="action-btn action-delete" bindtap="onDeleteLog" data-id="{{item.id}}">
              <text class="action-icon">🗑️</text>
            </view>
          </view>
          <!-- Swipeable Log Item -->
          <view class="log-item" 
                bindtouchstart="onTouchStart" 
                bindtouchmove="onTouchMove" 
                bindtouchend="onTouchEnd"
                bindtap="onLogItemTap"
                data-id="{{item.id}}"
                style="transform: translateX({{item.translateX || 0}}px); transition: {{item.transition ? 'transform 0.3s' : 'none'}};">
            <text class="log-time">{{item.time}}</text>
            <text class="log-icon">{{item.icon}}</text>
            <text class="log-name">{{item.name}}</text>
            <text class="log-cal">+{{item.cal}} kcal</text>
          </view>
        </view>
      </block>
      <view class="empty-state" wx:else>
         <text class="empty-icon">🍽️</text>
         <text>今天还没吃东西呢～</text>
      </view>
    </view>
  </view>

  <!-- Bottom Tab Bar -->
  <view class="tab-bar">
    <view class="tab-item active">
      <text class="tab-icon">🏠</text>
      <text class="tab-text">首页</text>
    </view>
    <view class="tab-item" bindtap="showPlaceholder" data-name="社区">
      <text class="tab-icon">👥</text>
      <text class="tab-text">社区</text>
    </view>
    <view class="tab-item" bindtap="showPlaceholder" data-name="我的">
      <text class="tab-icon">👤</text>
      <text class="tab-text">我的</text>
    </view>
  </view>

  <!-- Input Modal -->
  <view class="modal-overlay" wx:if="{{showInputModal}}">
    <view class="modal-card">
      <text class="modal-title">本次摄入 (kcal)</text>
      <input class="modal-input" type="number" focus="{{showInputModal}}" bindinput="onInputVal" value="{{inputValue}}" />
      <view class="modal-actions">
        <button class="btn-cancel" bindtap="closeModal">取消</button>
        <button class="btn-confirm" bindtap="confirmAdd">确定</button>
      </view>
    </view>
  </view>

  <!-- Edit Modal -->
  <view class="modal-overlay" wx:if="{{showEditModal}}">
    <view class="modal-card">
      <text class="modal-title">修改卡路里 (kcal)</text>
      <input class="modal-input" type="number" focus="{{showEditModal}}" bindinput="onEditInputVal" value="{{editValue}}" />
      <view class="modal-actions">
        <button class="btn-cancel" bindtap="closeEditModal">取消</button>
        <button class="btn-confirm" bindtap="confirmEdit">确定</button>
      </view>
    </view>
  </view>

</view>
